"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.renderSubscriptionTemplate = void 0;
function renderSubscriptionTemplate(subscription) {
    var currentTimestamp = Date.now() / 1000;
    var expireTimestamp = subscription.expire
        ? new Date(subscription.expire).getTime() / 1000
        : null;
    var remainingDays = expireTimestamp
        ? Math.floor((expireTimestamp - currentTimestamp) / (24 * 3600))
        : null;
    return "<!DOCTYPE html>\n<html lang=\"ru\">\n<head>\n    <meta charset=\"UTF-8\" />\n    <title>\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F \u043E \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0435</title>\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n    <script src=\"https://cdn.jsdelivr.net/gh/TaraRostami/qrious2/dist/qrious2.min.js\"></script>\n    <style>\n        :root {\n            --primary-color: #007bff;\n            --primary-hover: #0056b3;\n            --success-color: #4CAF50;\n            --warning-color: #FF9800;\n            --disabled-color: #9E9E9E;\n            --shadow-color: rgba(0, 0, 0, 0.1);\n            --border-radius: 8px;\n            --container-padding: clamp(16px, 4vw, 24px);\n        }\n\n        * {\n            box-sizing: border-box;\n            margin: 0;\n            padding: 0;\n        }\n\n        body {\n            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            background-color: #f7f7f7;\n            color: #333;\n            line-height: 1.5;\n            -webkit-font-smoothing: antialiased;\n        }\n\n        .container {\n            width: min(100% - 16px, 600px);\n            margin-inline: auto;\n            margin-block: 16px;\n            background-color: #fff;\n            padding: var(--container-padding);\n            box-shadow: 0 2px 12px var(--shadow-color);\n            border-radius: var(--border-radius);\n        }\n\n        h1 {\n            font-size: clamp(1.25rem, 4vw, 2rem);\n            margin-bottom: 1.25rem;\n        }\n\n        h2 {\n            font-size: clamp(1.125rem, 3.5vw, 1.5rem);\n            margin-bottom: 1rem;\n        }\n\n        p {\n            margin-bottom: 0.75rem;\n            font-size: clamp(0.875rem, 3vw, 1rem);\n        }\n\n        .status {\n            display: inline-flex;\n            align-items: center;\n            padding: 0.375rem 0.75rem;\n            border-radius: calc(var(--border-radius) / 2);\n            font-weight: 600;\n            font-size: 0.875rem;\n        }\n\n        .active { background-color: var(--success-color); color: #fff; }\n        .expired { background-color: var(--warning-color); color: #fff; }\n        .disabled { background-color: var(--disabled-color); color: #fff; }\n\n        .links-container {\n            margin-top: 1.5rem;\n        }\n\n        .links-container ul {\n            list-style: none;\n            display: flex;\n            flex-direction: column;\n            gap: 0.75rem;\n        }\n\n        .link-item {\n            display: flex;\n            flex-direction: column;\n            gap: 0.5rem;\n        }\n\n        .link-content {\n            display: flex;\n            flex-direction: column;\n            gap: 0.5rem;\n            width: 100%;\n        }\n\n        .subscription-name {\n            font-weight: 500;\n            color: #555;\n            font-size: 0.875rem;\n        }\n\n        .link-row {\n            display: flex;\n            flex-direction: column;\n            gap: 0.5rem;\n            width: 100%;\n        }\n\n        .link-input {\n            width: 100%;\n            padding: 0.75rem;\n            font-size: 0.875rem;\n            border: 1px solid #ddd;\n            border-radius: var(--border-radius);\n            background: #f8f9fa;\n            color: #333;\n            cursor: pointer;\n            transition: all 0.2s ease;\n        }\n\n        .link-input:hover {\n            background: #fff;\n            border-color: var(--primary-color);\n        }\n\n        .buttons-group {\n            display: flex;\n            gap: 0.5rem;\n        }\n\n        .btn {\n            flex: 1;\n            display: inline-flex;\n            align-items: center;\n            justify-content: center;\n            padding: 0.75rem 0.5rem;\n            font-size: 0.875rem;\n            font-weight: 500;\n            border: none;\n            border-radius: var(--border-radius);\n            cursor: pointer;\n            transition: all 0.2s ease;\n            background-color: var(--primary-color);\n            color: #fff;\n            min-width: 44px;\n        }\n\n        .btn:hover {\n            background-color: var(--primary-hover);\n        }\n\n        @media (min-width: 640px) {\n            .container {\n                width: min(100% - 32px, 600px);\n                margin-block: 32px;\n            }\n\n            .link-item {\n                flex-direction: row;\n                align-items: flex-start;\n            }\n\n            .subscription-name {\n                min-width: 150px;\n                padding-top: 0.75rem;\n            }\n\n            .link-row {\n                flex-direction: row;\n                align-items: center;\n            }\n\n            .buttons-group {\n                flex: 0 0 auto;\n            }\n\n            .btn {\n                min-width: 100px;\n            }\n        }\n\n        .qr-modal {\n            position: fixed;\n            inset: 0;\n            background: rgba(0, 0, 0, 0.5);\n            display: none;\n            place-items: center;\n            padding: 1rem;\n            backdrop-filter: blur(4px);\n            z-index: 1000;\n        }\n\n        .qr-content {\n            background: #fff;\n            padding: 2rem;\n            border-radius: var(--border-radius);\n            position: relative;\n            max-width: 90vw;\n            width: max-content;\n        }\n\n        .qr-close {\n            position: absolute;\n            top: 0.5rem;\n            right: 0.5rem;\n            background: none;\n            border: none;\n            font-size: 1.5rem;\n            cursor: pointer;\n            padding: 0.25rem;\n            line-height: 1;\n            color: #666;\n        }\n\n        .qr-close:hover {\n            color: #000;\n        }\n\n        .announce {\n            margin-top: 1.5rem;\n            padding: 1rem;\n            background-color: #fff3cd;\n            border-radius: var(--border-radius);\n            border-left: 4px solid var(--warning-color);\n        }\n\n        #qrCode {\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            min-height: 256px;\n            min-width: 256px;\n        }\n\n        #qrCode img {\n            max-width: 100%;\n            height: auto;\n        }\n\n        #qrCanvas {\n            max-width: 100%;\n            height: auto;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <h1>".concat(subscription.vpn_name || "Информация о подписке", "</h1>\n        <p>\u0421\u0442\u0430\u0442\u0443\u0441: <span class=\"status ").concat(expireTimestamp && expireTimestamp < currentTimestamp ? "expired" : "active", "\">").concat(expireTimestamp && expireTimestamp < currentTimestamp
        ? "Истекла"
        : "Активна", "</span></p>\n\n        <p>\u0414\u0430\u0442\u0430 \u043E\u043A\u043E\u043D\u0447\u0430\u043D\u0438\u044F: ").concat(expireTimestamp
        ? "".concat(new Date(expireTimestamp * 1000).toLocaleString("ru-RU"), " (\u043E\u0441\u0442\u0430\u043B\u043E\u0441\u044C ").concat(remainingDays, " \u0434\u043D\u0435\u0439)")
        : "∞", "</p>\n\n        ").concat(subscription.announce
        ? "<div class=\"announce\">".concat(subscription.announce, "</div>")
        : "", "\n\n        <div class=\"links-container\">\n            <h2>\u0421\u0441\u044B\u043B\u043A\u0438:</h2>\n            <ul>\n                ").concat(subscription.links
        .map(function (link) { return "\n                    <li class=\"link-item\">\n                        <div class=\"subscription-name\">".concat(link.url.split("#")[1] || "", "</div>\n                        <div class=\"link-content\">\n                            <div class=\"link-row\">\n                                <input type=\"text\" class=\"link-input\" value=\"").concat(link.url, "\" readonly />\n                                <div class=\"buttons-group\">\n                                    <button class=\"btn copy-btn\" data-link=\"").concat(link.url, "\">\u041A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u0442\u044C</button>\n                                    <button class=\"btn qr-btn\" data-link=\"").concat(link.url, "\">QR</button>\n                                </div>\n                            </div>\n                        </div>\n                    </li>\n                "); })
        .join(""), "\n            </ul>\n        </div>\n    </div>\n\n    <div class=\"qr-modal\" id=\"qrModal\">\n        <div class=\"qr-content\">\n            <button class=\"qr-close\" aria-label=\"\u0417\u0430\u043A\u0440\u044B\u0442\u044C\">&times;</button>\n            <div id=\"qrCode\"></div>\n        </div>\n    </div>\n\n    <script>\n        document.addEventListener('DOMContentLoaded', () => {\n            const copyBtns = document.querySelectorAll('.copy-btn');\n            const qrBtns = document.querySelectorAll('.qr-btn');\n            const qrModal = document.getElementById('qrModal');\n            const qrClose = qrModal.querySelector('.qr-close');\n            const qrCode = document.getElementById('qrCode');\n\n            // \u041A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 \u0441\u0441\u044B\u043B\u043A\u0438\n            copyBtns.forEach(btn => {\n                btn.addEventListener('click', async () => {\n                    const link = btn.dataset.link;\n                    try {\n                        await navigator.clipboard.writeText(link);\n                        btn.textContent = '\u0421\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u043E!';\n                        setTimeout(() => btn.textContent = '\u041A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u0442\u044C', 1500);\n                    } catch (err) {\n                        // Fallback \u0434\u043B\u044F \u0441\u0442\u0430\u0440\u044B\u0445 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043E\u0432\n                        const input = document.createElement('input');\n                        input.value = link;\n                        document.body.appendChild(input);\n                        input.select();\n                        document.execCommand('copy');\n                        document.body.removeChild(input);\n                        btn.textContent = '\u0421\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u043E!';\n                        setTimeout(() => btn.textContent = '\u041A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u0442\u044C', 1500);\n                    }\n                });\n            });\n\n            // \u0413\u0435\u043D\u0435\u0440\u0430\u0446\u0438\u044F QR \u043A\u043E\u0434\u0430\n            qrBtns.forEach(btn => {\n                btn.addEventListener('click', () => {\n                    const link = btn.dataset.link;\n                    \n                    // \u041E\u0447\u0438\u0449\u0430\u0435\u043C \u043F\u0440\u0435\u0434\u044B\u0434\u0443\u0449\u0438\u0439 QR \u043A\u043E\u0434 \u0438 \u0441\u043E\u0437\u0434\u0430\u0435\u043C \u043D\u043E\u0432\u044B\u0439 canvas\n                    qrCode.innerHTML = '<canvas id=\"qrCanvas\"></canvas>';\n                    \n                    try {\n                        // \u0421\u043E\u0437\u0434\u0430\u0435\u043C \u043D\u043E\u0432\u044B\u0439 QR \u043A\u043E\u0434 \u0441 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u043D\u044B\u043C\u0438 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u043C\u0438\n                        const qr = new QRious({\n                            element: document.getElementById('qrCanvas'),\n                            value: link.split('#')[0] + '#' + encodeURIComponent(link.split('#')[1]),\n                            size: 400,\n                            background: 'white',\n                            backgroundAlpha: 0,\n                            foreground: 'black',\n                            padding: 2,\n                            level: 'L'\n                        });\n                    } catch (e) {\n                        console.error('Failed to generate QR code:', e);\n                        qrCode.innerHTML = '<p style=\"color: red; text-align: center;\">\u041E\u0448\u0438\u0431\u043A\u0430 \u0433\u0435\u043D\u0435\u0440\u0430\u0446\u0438\u0438 QR \u043A\u043E\u0434\u0430</p>';\n                        return;\n                    }\n\n                    qrModal.style.display = 'grid';\n                });\n            });\n\n            // \u0417\u0430\u043A\u0440\u044B\u0442\u0438\u0435 \u043C\u043E\u0434\u0430\u043B\u044C\u043D\u043E\u0433\u043E \u043E\u043A\u043D\u0430\n            qrClose.addEventListener('click', () => {\n                qrModal.style.display = 'none';\n            });\n\n            qrModal.addEventListener('click', (e) => {\n                if (e.target === qrModal) {\n                    qrModal.style.display = 'none';\n                }\n            });\n        });\n    </script>\n</body>\n</html>");
}
exports.renderSubscriptionTemplate = renderSubscriptionTemplate;
